# 📅 Meal Planner Feature

## Overview

The meal planner allows users to plan their weekly meals by dragging recipes from the library onto a weekly calendar. Plans are saved locally in the browser and can be exported as shopping lists.

## Features

✨ **Drag-and-Drop Interface** - Simply drag recipes from the library onto any meal slot  
📅 **Weekly Planning** - Plan breakfast, lunch, and dinner for the entire week  
🔍 **Recipe Search & Filters** - Quickly find recipes by name, tags, or meal type  
💾 **Auto-Save** - Meal plans are automatically saved to browser localStorage  
📱 **Responsive Design** - Works great on desktop and mobile  
🖨️ **Print Support** - Print your weekly meal plan  
📝 **Shopping List Export** - Download a text file with all planned recipes  

## How It Works

### For Users

1. **Navigate to Meal Planner** - Click "📅 Meal Planner" in the navigation
2. **Browse Recipes** - Search or filter recipes in the left sidebar
3. **Drag to Calendar** - Drag any recipe card to a meal slot in the calendar
4. **Navigate Weeks** - Use Previous/Next Week buttons to plan multiple weeks
5. **Export** - Click "Shopping List" to download your planned recipes

### For Developers

#### File Structure

```
tools/
  └── astro-data-to-recipes.cjs    # Converts Astro data store to JSON
public/
  └── recipes.json                  # Recipe data for meal planner
src/
  └── pages/
      └── planner.astro             # Meal planner page
```

#### Data Flow

1. Recipe frontmatter is stored in `.astro/data-store.json` (generated by Astro)
2. Conversion script reads the data store and creates `public/recipes.json`
3. Meal planner page fetches `recipes.json` and renders the UI
4. User interactions are saved to `localStorage`

#### Build Process

The `build` script has been updated to generate `recipes.json` before building:

```bash
npm run build:recipes  # Generate recipes.json
npm run build          # Build site (includes build:recipes)
```

**Note:** If `.astro/data-store.json` doesn't exist (fresh clone), you may need to:
1. Run `npm run dev` or `npm run build` first to generate the data store
2. Then run `npm run build:recipes` to generate `recipes.json`

#### Recipe JSON Format

Each recipe in `recipes.json` contains:

```json
{
  "slug": "recipe-slug",
  "title": "Recipe Title",
  "href": "/recipe-site/recipes/recipe-slug/",
  "prepTime": "15 min",
  "cookTime": "30 min",
  "totalTime": "45 min",
  "servings": "4-6 servings",
  "difficulty": "Easy|Medium|Hard",
  "tags": ["tag1", "tag2"],
  "mealType": "breakfast|main|side|dessert",
  "image": "/images/recipes/image.jpg"
}
```

## Customization

### Changing Meal Times

Edit the `MEALS` array in `src/pages/planner.astro`:

```javascript
const MEALS = [
  { key: 'breakfast', label: '🌅 Breakfast', icon: 'fa-coffee' },
  { key: 'lunch', label: '🥗 Lunch', icon: 'fa-sandwich' },
  { key: 'dinner', label: '🍽️ Dinner', icon: 'fa-utensils' }
];
```

### Adding More Filter Options

Update the filter buttons in the recipe library section:

```html
<button class="filter-tag" data-filter="new-type">New Type</button>
```

### Styling

All planner styles are contained within `<style>` tags in `planner.astro`. Key CSS classes:

- `.planner-section` - Main container
- `.recipe-library` - Left sidebar
- `.weekly-calendar` - Main calendar area
- `.day-card` - Individual day column
- `.meal-slot` - Droppable meal slot

## Browser Storage

Meal plans are stored in `localStorage` with the key `mealPlans`:

```javascript
{
  "2025-01-06": {  // Week start date (Monday)
    "Monday-breakfast": "recipe-slug",
    "Monday-lunch": "another-recipe",
    // ...
  },
  "2025-01-13": { /* next week */ }
}
```

## Future Enhancements

Potential improvements:

- [ ] Add serving size multipliers for recipes
- [ ] Smart shopping list with ingredient aggregation
- [ ] Share meal plans via URL
- [ ] Meal plan templates (e.g., "Vegetarian Week")
- [ ] Nutritional information display
- [ ] Integration with calendar apps (iCal export)
- [ ] Recipe suggestions based on ingredients on hand

## Troubleshooting

**Q: Recipes aren't loading**  
A: Check that `public/recipes.json` exists and is valid JSON. Run `npm run build:recipes` to regenerate it.

**Q: Meal plans aren't saving**  
A: Check browser console for localStorage errors. Private/incognito mode may block localStorage.

**Q: Images aren't showing**  
A: Verify image paths in recipe frontmatter match actual files in `public/images/recipes/`.

**Q: Build fails with "Cannot find .astro/data-store.json"**  
A: Run `npm run dev` or `astro build` once to generate the data store, then retry.

## Credits

Built with Astro and vanilla JavaScript. Uses Font Awesome icons and native drag-and-drop API.


